---
path: /build-a-coding-blog-with-mdx-and-gatsby-2019
date: 2019-12-31
title: Build a coding blog from scratch with Gatsby and MDX
tags:
  ['information', 'learning', 'gatsby', 'guide', 'mdx', 'markdown']
published: false
cover: ./cover.jpg
coverCredit: Photo by SpaceX on Unsplash
---

I have been using Gatsby since [v0 May 2017], at that time it was a
template I cloned and used happily it was called Lumen and was just
what I needed at the time.

Over the years I have made my own [Progressive Disclosure of
Complexity] with Gatsby to where I am now.

## What we're going to build

We're going to build a developer blog with MDX support for some react
components in Markdown goodness.

## Also:

- Basic styling with styled-components
- cover images for the posts
- auto link headers
- SEO component
- RSS Feed
- Offline Support

## Who is this for?

People that may have used Gatsby before as a template and now want to
get more involved in how to make changes.

If you want to use styled-components in an app.

## Requirements

We're going to need a basic web development setup: node, terminal
(bash, zsh or fish) and a text editor.

I do like to use [codesandbox.io] for these sort of guides to reduce
the barrier to entry but in this case I have found there are some
limitations with starting out from scratch on [codesandbox.io] which
doesn't make this possible.

I have made a guide on getting set up for web development with
[Windows Web-Dev Bootstrap] and covered the same process in [Ubuntu as
well].

Ok? Let's get started!

<!-- TOC -->

- [Hello World](#hello-world)
  - [basic hello world](#basic-hello-world)
- [Add content](#add-content)
- [Gatsby config API](#gatsby-config-api)
- [Plugins](#plugins)
  - [Gatsby source filesystem](#gatsby-source-filesystem)
  - [Gatsby plugin MDX](#gatsby-plugin-mdx)
- [Query data from GraphQL](#query-data-from-graphql)
- [Site Metadata](#site-metadata)
- [Site metadata hook](#site-metadata-hook)
- [Styling](#styling)
- [Layout](#layout)
- [Index page posts query](#index-page-posts-query)
- [Slugs and Paths](#slugs-and-paths)
- [Previous and Next](#previous-and-next)
- [Code Blocks](#code-blocks)
- [Cover Image](#cover-image)
- [i11n](#i11n)
- [SEO](#seo)
- [Commenting](#commenting)
- [Links](#links)

<!-- /TOC -->

## Hello World

Let's kick this off with the Gatsby 'hello world', we'll need to
install the following:

```bash
npm init -y
yarn add gatsby react react-dom
```

If you want to commit this to a git repository then you'll also need a
`.gitignore` with the requisite things to ignore, `node_modules`,
`.cache` and `public`:

```bash
touch .gitignore

echo "# Project dependencies
.cache
node_modules

# Build directory
public

# Other
.DS_Store
yarn-error.log" > .gitignore
```

Ok now is a good time to do a `git init` and if you're using VSCode
you'll see the changes reflected in the sidebar.

### basic hello world

Ok the bare minimum for a Gatsby hello world!

We're going to need to create a pages directory and add an index file.
We can do that in the terminal by typing the following:

```bash
# -p is to create parent directories too if needed
mkdir -p src/pages
touch src/pages/index.js
```

Ok, now we can commence the hello work incantation! In the newly
created `index.js` enter the following:

```js
import React from 'react';

export default () => {
  return <h1>Hello World!</h1>;
};
```

Now we need to add the Gatsby develop script to the `package.json`
file, `-p` specifies what port you want to run the project on and `-o`
opens a new tab on your default browser, so in this case
`localhost:9988`:

```json
"dev": "gatsby develop -p 9988 -o"
```

Ok it's time to run the code! From the terminal type the npm script
command we just created:

```bash
yarn dev
```

> Note I'm using Yarn for installing all my dependencies and running
> scripts, if you prefer you can use npm just bear in mind that the
> content on here uses yarn, so swap out commands where needed

And with that the "Hello World" incantation is complete ðŸ§™!

## Add content

Ok, now we have the base our blog we're going to want to add some
content, first up I'm going to get the convention out of the way. I
like my date format a logical way, the most logical way for a date
format is **YYYYMMDD**, fight me!

So we're going to structure our posts content in years, in each one of
those we're going to have another folder relating to the post with the
(correct) date format for the beginning of the file followed by the
title of the post. You could drill into this further if you like by
separating out months and days depending on the volume of posts going
this may be a good approach. In this case we're going to go with the
convention I've detailed already.

```bash
# create multiple directories using curly braces
mkdir -p posts/2019/{2019-06-01-hello-world,2019-06-10-second-post,2019-06-20-third-post}
touch posts/2019/2019-06-01-hello-world/index.mdx
touch posts/2019/2019-06-10-second-post/index.mdx
touch posts/2019/2019-06-20-third-post/index.mdx
```

Ok that's our posts set up now we need to add some content to them,
each file we have in here should have frontmatter. Frontmatter is a
way to assign properties to the contents, in this case a `title`,
published `date` and a `published` flag (`true` or `false`).

```md
---
title: Hello World - from mdx!
date: 2019-06-01
published: true
---

# h1 Heading

My first post!!

## h2 Heading

### h3 Heading
```

```md
---
title: Second Post!
date: 2019-06-10
published: true
---

This is my second post!

#### h4 Heading

##### h5 Heading

###### h6 Heading
```

```md
---
title: Third Post!
date: 2019-06-20
published: true
---

This is my third post!

> with a block quote!
```

## Gatsby config API

Ok, now we're going to configure Gatsby so that it can read our super
awesome content we just created. So first up we need to create a the
`gatsby-config.js` file, in the terminal create the file:

```bash
touch gatsby-config.js
```

## Plugins

And now we can add the plugins Gatsby needs to use for sourcing and
displaying the the files we just created.

### Gatsby source filesystem

The [gatsby-source-filesystem] collects the files on the local
filesystem for use in Gatsby once configured.

### Gatsby plugin MDX

The [gatsby-plugin-mdx] is what will be allowing us to write JSX in
our Markdown documents and the heart of how the content is displayed
in the blog.

Now is a good time to also add in dependent packages for the Gatsby
plugin MDX which are `@mdx-js/mdx` and `@mdx-js/react`.

In the terminal install the dependencies:

```bash
yarn add gatsby-plugin-mdx @mdx-js/mdx @mdx-js/react gatsby-source-filesystem
```

Now its time to configure `gatsby-config.js`:

```js
module.exports = {
  siteMetadata: {
    title: `The Localhost Blog`,
    description: `This is my coding blog where I write about my coding journey.`,
  },
  plugins: [
    {
      resolve: `gatsby-plugin-mdx`,
      options: {
        extensions: [`.mdx`, `.md`],
      },
    },
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        path: `${__dirname}/posts`,
        name: `posts`,
      },
    },
  ],
};
```

## Query data from GraphQL

Ok now we can see what the [gatsby-source-filesystem] and
[gatsby-plugin-mdx] have done for us. We can now go to the Gatsby
GraphQL GraphiQL explorer and check out the data:

```graphql
{
  allMdx {
    nodes {
      frontmatter {
        title
        date
      }
    }
  }
}
```

## Site Metadata

When you want to reuse common pieces of data across the site (for
example, your site title), you can store that data in `siteMetadata`,
we touched on this when defining the `gatsby-config.js`, now we're
going to separate this out from the `module.exports`, why? It will be
nicer to reason about once the config is filled with plugins. At the
top of `gatsby-config.js` add a new object variable for the site
metadata:

```js
const siteMetadata = {
  title: `The Localhost Blog`,
  description: `This is my coding blog where I write about my coding journey.`,
};
```

Now let's query the Site Metadata with GraphQL.

```graphql
{
  site {
    siteMetadata {
      title
      description
    }
  }
}
```

## Site metadata hook

Ok, so, that's cool n' all but how am I meant to use it? Well let's do
some of the code stuff and make a React hook so we can get our site
data in any component we need it.

Let's create a folder to keep all our hooks in and create a file for
our hook, in the terminal do:

```bash
mkdir src/hooks
touch src/hooks/useSiteMetadata.js
```

Ok, and in our newly created file were goining to use the Gatsby
`useStaticQuery` hook to make our own hook:

```js
import { graphql, useStaticQuery } from 'gatsby';

export const useSiteMetadata = () => {
  const { site } = useStaticQuery(
    graphql`
      query SITE_METADATA_QUERY {
        site {
          siteMetadata {
            title
            description
          }
        }
      }
    `
  );
  return site.siteMetadata;
};
```

Now we can use this hook anywhere in our site, so let's do that now in
`src/pages/index.js`:

```js
import React from 'react';
import { useSiteMetadata } from '../hooks/useSiteMetadata';

export default () => {
  const { title, description } = useSiteMetadata();
  return (
    <>
      <h1>{title}</h1>
      <p>{description}</p>
    </>
  );
};
```

## Styling

We're going to use styled-components for styling, styled-components
(for me) help with scoping styles in your components. Let's go over
the basics now.

### install styled-components

```bash
yarn add gatsby-plugin-styled-components styled-components babel-plugin-styled-components
```

So, what was all that I just installed?

The babel plugin is for automatic naming of components to help with
debugging.

The Gatsby plugin is for built-in server-side rendering support.

### Configure

Ok, with that detailed explanation out of the way let's configure them
in `gatsby-config.js`:

```js
const siteMetadata = {
  title: `The Localhost Blog`,
  description: `This is my coding blog where I write about my coding journey.`,
};

module.exports = {
  siteMetadata: siteMetadata,
  plugins: [
    `gatsby-plugin-styled-components`,
    {
      resolve: `gatsby-plugin-mdx`,
      options: {
        extensions: [`.mdx`, `.md`],
      },
    },
    {
      resolve: `gatsby-source-filesystem`,
      options: { path: `${__dirname}/posts`, name: `posts` },
    },
  ],
};
```

Ok, so let's go over a styled component, in `index.js` we're going to
`import styled from 'styled-components'` and create a `StyledH1`
variable.

So, we're using the variable to wrap our `{title}` that we're
destructuring from the `useSiteMetadata` hook we made previously.

For this example lets make it the now iconic Gatsby `rebeccapurple`.

```js
import React from 'react';
import styled from 'styled-components';
import { useSiteMetadata } from '../hooks/useSiteMetadata';

const StyledH1 = styled.h1`
  color: rebeccapurple;
`;

export default () => {
  const { title, description } = useSiteMetadata();
  return (
    <>
      <StyledH1>{title}</StyledH1>
      <p>{description}</p>
    </>
  );
};
```

That is styled-components on a very basic level, basically create the
styling you want for your page elements you're creating in the JSX.

## Layout

Gatsby doesn't apply any layouts by default but instead uses the way
you can compose React components for the layout, meaning it's up to
you how you want to layout what your building with Gatsby. In this
guide were going to initially create a basic layout component that
we'll add to as we go along. For more detail on layout components take
a look at the Gatsby [layout components] page.

Ok, so now we're going to refactor the home page
(`src/pages/index.js`) a little and make some components for our blog
layout and header. In the terminal create a components directory and a
`Header` and `Layout` component:

```bash
mkdir src/components
touch src/components/Header.js src/components/Layout.js
```

Now to move the title and description from `src/pages/index.js` to the
newly created `src/components/Header.js` component, destructuring
props for the `siteTitle` and `siteDescription`, we'll pass these from
the `Layout` component to here. We're going to add Gatsby Link to this
so users can click on the header to go back to the home page.

```js
import { Link } from 'gatsby' import React from 'react'

export const Header = ({ siteTitle, siteDescription }) => (
  <Link to="/">
    <h1>{siteTitle}</h1>
    <p>{siteDescription}</p>
  </Link>
);
```

Now to the Layout component, this is going to be a basic wrapper
component for now, we're going to use our site metadata hook for the
title and description and pass them to the header component and return
the children of the wrapper (`Layout`).

```js
import React from 'react';
import { useSiteMetadata } from '../hooks/useSiteMetadata';
import { Header } from './Header';

export const Layout = ({ children }) => {
  const { title, description } = useSiteMetadata();
  return (
    <>
      <Header siteTitle={title} siteDescription={description} />
      {children}
    </>
  );
};
```

Now to add the slightest of styles for some alignment for
`src/components/Layout.js`, create an `AppStyles` styled component and
make it the main wrapper of our `Layout`.

```js
import React from 'react';
import styled from 'styled-components';
import { useSiteMetadata } from '../hooks/useSiteMetadata';
import { Header } from './Header';

const AppStyles = styled.main`
  width: 800px;
  margin: 0 auto;
`;

export const Layout = ({ children }) => {
  const { title, description } = useSiteMetadata();
  return (
    <AppStyles>
      <Header siteTitle={title} siteDescription={description} />
      {children}
    </AppStyles>
  );
};
```

Ok, now let's refactor our homepage (`src/pages/index.js`) with
`Layout`.

```js
import React from 'react';
import { Layout } from '../components/Layout';

export default () => {
  return (
    <>
      <Layout />
    </>
  );
};
```

## Index page posts query

- add graphql query with sort to `src/pages/index.js`

```js
import { graphql } from 'gatsby';
import React from 'react';
import { Layout } from '../components/Layout';

export default ({ data }) => {
  return (
    <>
      <Layout>
        {data.allMdx.edges.map(({ node }, index) => (
          <>
            <h1>{node.frontmatter.title}</h1>
            <p>{node.frontmatter.date}</p>
            <p>{node.excerpt}</p>
          </>
        ))}
      </Layout>
    </>
  );
};

export const query = graphql`
  query SITE_INDEX_QUERY {
    allMdx(
      sort: { fields: [frontmatter___date], order: DESC }
      filter: { frontmatter: { published: { eq: true } } }
    ) {
      edges {
        node {
          id
          excerpt(pruneLength: 250)
          frontmatter {
            title
            date
          }
        }
      }
    }
  }
`;
```

## Slugs and Paths

- Gatsby node, add onCreateNode for slugs

```bash
touch gatsby-node.js
```

```js
const { createFilePath } = require(`gatsby-source-filesystem`);

exports.onCreateNode = ({ node, actions, getNode }) => {
  const { createNodeField } = actions;
  if (node.internal.type === `Mdx`) {
    const value = createFilePath({ node, getNode });
    createNodeField({
      name: `slug`,
      node,
      value,
    });
  }
};
```

- Add Dump.js for debugging

```js
import React from 'react';

const Dump = props => (
  <div
    style={{
      fontSize: 20,
      border: '1px solid #efefef',
      padding: 10,
      background: 'white',
    }}>
    {Object.entries(props).map(([key, val]) => (
      <pre key={key}>
        <strong style={{ color: 'white', background: 'red' }}>
          {key} ðŸ’©
        </strong>
        {JSON.stringify(val, '', ' ')}
      </pre>
    ))}
  </div>
);

export default Dump;
```

- add gatsby Link to `src/pages/index.js` and fields slug

```js
import { graphql, Link } from 'gatsby';
import React from 'react';
import styled from 'styled-components';
import { Layout } from '../components/Layout';

const IndexWrapper = styled.main``;

const PostWrapper = styled.div``;

export default ({ data }) => {
  return (
    <Layout>
      <IndexWrapper>
        {data.allMdx.edges.map(({ node }, index) => (
          <PostWrapper key={index}>
            <Link to={node.fields.slug}>
              <h1>{node.frontmatter.title}</h1>
              <p>{node.frontmatter.date}</p>
              <p>{node.excerpt}</p>
            </Link>
          </PostWrapper>
        ))}
      </IndexWrapper>
    </Layout>
  );
};

export const query = graphql`
  query SITE_INDEX_QUERY {
    allMdx(
      sort: { fields: [frontmatter___date], order: DESC }
      filter: { frontmatter: { published: { eq: true } } }
    ) {
      edges {
        node {
          id
          excerpt(pruneLength: 250)
          frontmatter {
            title
            date
          }
          fields {
            slug
          }
        }
      }
    }
  }
`;
```

- Blog Post Template

```bash
mkdir -p src/templates
touch src/templates/blogPostTemplate.js
```

- scaffold out basic template

```js
import React from 'react';

export default () => {
  return (
    <>
      <p>post here</p>
    </>
  );
};
```

- Create createPages export
- Actions is where create pages lives
- Detail here:
  [https://www.gatsbyjs.org/docs/node-apis/#createPages](https://www.gatsbyjs.org/docs/node-apis/#createPages)

```js
const path = require(`path`);

exports.createPages = ({ actions, graphql }) => {
  const { createPage } = actions;
  const blogPostTemplate = path.resolve(
    'src/templates/blogPostTemplate.js'
  );

  return graphql(`
    {
      allMdx {
        edges {
          node {
            fields {
              slug
            }
            frontmatter {
              title
            }
          }
        }
      }
    }
  `).then(result => {
    if (result.errors) {
      throw result.errors;
    }

    const posts = result.data.allMdx.edges;

    // create page for each mdx file
    posts.forEach((post, index) => {
      createPage({
        path: post.node.fields.slug,
        component: blogPostTemplate,
        context: {
          slug: post.node.fields.slug,
        },
      });
    });
  });
};
```

- build out blogPostTemplate.js

```js
import { graphql } from 'gatsby';
import MDXRenderer from 'gatsby-plugin-mdx';
import React from 'react';
import { Layout } from '../components/Layout';

export default ({ data }) => {
  const { frontmatter, code } = data.mdx;
  return (
    <Layout>
      <h1>{frontmatter.title}</h1>
      <p>{frontmatter.date}</p>
      <MDXRenderer>{code.body}</MDXRenderer>
    </Layout>
  );
};

export const query = graphql`
  query PostsBySlug($slug: String!) {
    mdx(fields: { slug: { eq: $slug } }) {
      excerpt(pruneLength: 250)
      code {
        body
      }
      frontmatter {
        title
        date(formatString: "YYYY MMMM Do")
      }
    }
  }
`;
```

## Previous and Next

- Add in previous and next context

```js
// create page for each mdx file
posts.forEach((post, index) => {
  const previous =
    index === posts.length - 1 ? null : posts[index + 1].node;
  const next = index === 0 ? null : posts[index - 1].node;

  createPage({
    path: post.node.fields.slug,
    component: blogPostTemplate,
    context: {
      slug: post.node.fields.slug,
      previous,
      next,
    },
  });
});
```

- Expose props in blogPostTemplate.js via pageContext with Dump

```js
import { graphql, Link } from 'gatsby'
import { MDXRenderer } from "gatsby-plugin-mdx";
import React from 'react'
import { Dump } from '../components/Dump'
import { Layout } from '../components/Layout'

export default ({ data, pageContext }) => {
  const { frontmatter, code } = data.mdx
  const { previous, next } = pageContext
  return (
    <Layout>
      <h1>{frontmatter.title}</h1>
      <p>{frontmatter.date}</p>
      <MDXRenderer>{body}</MDXRenderer>
      <Dump previous={previous} />
      <Dump next={next}
    </Layout>
  )
}

export const query = graphql`
  query PostsBySlug($slug: String!) {
    mdx(fields: { slug: { eq: $slug } }) {
      excerpt(pruneLength: 250)
      body
      frontmatter {
        title
        date(formatString: "YYYY MMMM Do")
      }
    }
  }
`
```

Add in previous and next navigation:

```js
import { graphql, Link } from 'gatsby';
import MDXRenderer from 'gatsby-plugin-mdx';
import React from 'react';
import { Dump } from '../components/Dump';
import { Layout } from '../components/Layout';
export default ({ data, pageContext }) => {
  const { frontmatter, code } = data.mdx;
  const { previous, next } = pageContext;
  return (
    <Layout>
      <h1>{frontmatter.title}</h1>
      <p>{frontmatter.date}</p>
      <MDXRenderer>{code.body}</MDXRenderer>
      <Dump previous={previous} />
      <Dump next={next} />
      {previous === false ? null : (
        <>
          {previous && (
            <Link to={previous.fields.slug}>
              <p>{previous.frontmatter.title}</p>
            </Link>
          )}
        </>
      )}
      {next === false ? null : (
        <>
          {next && (
            <Link to={next.fields.slug}>
              <p>{next.frontmatter.title}</p>
            </Link>
          )}
        </>
      )}
    </Layout>
  );
};

export const query = graphql`
  query PostsBySlug($slug: String!) {
    mdx(fields: { slug: { eq: $slug } }) {
      excerpt(pruneLength: 250)
      code {
        body
      }
      frontmatter {
        title
        date(formatString: "YYYY MMMM Do")
      }
    }
  }
`;
```

## Code Blocks

- add prism react renderer and react live and root-wrapper

```bash
yarn add prism-react-renderer react-live
touch root-wrapper.js gatsby-ssr.js gatsby-browser.js
```

- Add root-wrapper.js code, demonstrate components

```js
import { MDXProvider } from '@mdx-js/react';
import React from 'react';

const components = {
  h1: ({ children }) => (
    <h1 style={{ color: 'rebeccapurple' }}>{children}</h1>
  ),
};

export const wrapRootElement = ({ element }) => (
  <MDXProvider components={components}>{element}</MDXProvider>
);
```

- add gatsby-browser and gatsby-ssr code

```js
import { wrapRootElement as wrap } from './root-wrapper';

export const wrapRootElement = wrap;
```

- [https://github.com/FormidableLabs/prism-react-renderer](https://github.com/FormidableLabs/prism-react-renderer)
- Copy code for highlighting, test it works

```js
import { MDXProvider } from '@mdx-js/react';
import Highlight, { defaultProps } from 'prism-react-renderer';
import React from 'react';

const components = {
  pre: props => (
    <Highlight
      {...defaultProps}
      code={`
        (function someDemo() {
          var test = "Hello World!";
          console.log(test);
        })();

        return () => <App />;
      `}
      language="jsx">
      {({
        className,
        style,
        tokens,
        getLineProps,
        getTokenProps,
      }) => (
        <pre className={className} style={style}>
          {tokens.map((line, i) => (
            <div {...getLineProps({ line, key: i })}>
              {line.map((token, key) => (
                <span {...getTokenProps({ token, key })} />
              ))}
            </div>
          ))}
        </pre>
      )}
    </Highlight>
  ),
};

export const wrapRootElement = ({ element }) => (
  <MDXProvider components={components}>{element}</MDXProvider>
);
```

- Now, get the props of the child component of the pre component

```js
import { MDXProvider } from '@mdx-js/react';
import Highlight, { defaultProps } from 'prism-react-renderer';
import React from 'react';

const components = {
  pre: props => (
    <Highlight
      {...defaultProps}
      code={props.children.props.children.trim()}
      language="jsx">
      {({
        className,
        style,
        tokens,
        getLineProps,
        getTokenProps,
      }) => (
        <pre className={className} style={style}>
          {tokens.map((line, i) => (
            <div {...getLineProps({ line, key: i })}>
              {line.map((token, key) => (
                <span {...getTokenProps({ token, key })} />
              ))}
            </div>
          ))}
        </pre>
      )}
    </Highlight>
  ),
};

export const wrapRootElement = ({ element }) => (
  <MDXProvider components={components}>{element}</MDXProvider>
);
```

- Then to match the language

```js
import { MDXProvider } from '@mdx-js/react';
import Highlight, { defaultProps } from 'prism-react-renderer';
import React from 'react';

const components = {
  pre: props => {
    const className = props.children.props.className || '';
    const matches = className.match(/language-(?<lang>.*)/);

    return (
      <Highlight
        {...defaultProps}
        code={props.children.props.children.trim()}
        language={
          matches && matches.groups && matches.groups.lang
            ? matches.groups.lang
            : ''
        }>
        {({
          className,
          style,
          tokens,
          getLineProps,
          getTokenProps,
        }) => (
          <pre className={className} style={style}>
            {tokens.map((line, i) => (
              <div {...getLineProps({ line, key: i })}>
                {line.map((token, key) => (
                  <span {...getTokenProps({ token, key })} />
                ))}
              </div>
            ))}
          </pre>
        )}
      </Highlight>
    );
  },
};

export const wrapRootElement = ({ element }) => (
  <MDXProvider components={components}>{element}</MDXProvider>
);
```

- add the theme

```js
import { MDXProvider } from '@mdx-js/react';
import Highlight, { defaultProps } from 'prism-react-renderer';
import theme from 'prism-react-renderer/themes/nightOwl';
import React from 'react';

const components = {
  pre: props => {
    const className = props.children.props.className || '';
    const matches = className.match(/language-(?<lang>.*)/);

    return (
      <Highlight
        {...defaultProps}
        code={props.children.props.children.trim()}
        language={
          matches && matches.groups && matches.groups.lang
            ? matches.groups.lang
            : ''
        }
        theme={theme}>
        {({
          className,
          style,
          tokens,
          getLineProps,
          getTokenProps,
        }) => (
          <pre className={className} style={style}>
            {tokens.map((line, i) => (
              <div {...getLineProps({ line, key: i })}>
                {line.map((token, key) => (
                  <span {...getTokenProps({ token, key })} />
                ))}
              </div>
            ))}
          </pre>
        )}
      </Highlight>
    );
  },
};

export const wrapRootElement = ({ element }) => (
  <MDXProvider components={components}>{element}</MDXProvider>
);
```

- Now react-live
- Make a `Code.js` component, move the code from `root-wrapper.js`
  into there

```js
import { MDXProvider } from '@mdx-js/react';
import React from 'react';
import Code from './src/components/Code';

// import { Dump } from './src/utils/helpers';

// components is its own object outside of render so that the references to
// components are stable
const components = {
  pre: ({ children: { props } }) => {
    // if there's a codeString and some props, we passed the test
    if (props.mdxType === 'code') {
      return (
        <Code
          codeString={props.children.trim()}
          language={
            props.className &&
            props.className.replace('language-', '')
          }
          {...props}
        />
      );
    }
    // it's possible to have a pre without a code in it
    return <pre />;
  },
  wrapper: ({ children }) => <>{children}</>,
};

export const wrapRootElement = ({ element }) => (
  <MDXProvider components={components}>{element}</MDXProvider>
);
```

- Create elements folder

```bash
mkdir -p src/components/elements
touch src/components/elements/Code.js
```

- add Code component

```js
import Highlight, { defaultProps } from 'prism-react-renderer';
import theme from 'prism-react-renderer/themes/nightOwl';
import React from 'react';
import {
  LiveEditor,
  LiveError,
  LivePreview,
  LiveProvider,
} from 'react-live';
import styled from 'styled-components';
// import { Dump } from '../utils/helpers'

export const Pre = styled.pre`
  text-align: left;
  margin: 1em 0;
  padding: 0.5em;
  overflow-x: auto;
  border-radius: 3px;
  & .token-line {
    line-height: 1.3em;
    height: 1.3em;
  }
  font-family: dm;
`;

export const LineNo = styled.span`
  display: inline-block;
  width: 2em;
  user-select: none;
  opacity: 0.3;
`;

export const Code = ({ codeString, language, ...props }) => {
  if (props['react-live']) {
    return (
      <LiveProvider code={codeString} noInline={true} theme={theme}>
        <LiveEditor />
        <LiveError />
        <LivePreview />
      </LiveProvider>
    );
  }
  return (
    <>
      <Highlight
        {...defaultProps}
        code={codeString}
        language={language}
        theme={theme}>
        {({
          className,
          style,
          tokens,
          getLineProps,
          getTokenProps,
        }) => (
          <Pre className={className} style={style}>
            {tokens.map((line, i) => (
              <div {...getLineProps({ line, key: i })}>
                <LineNo>{i + 1}</LineNo>
                {line.map((token, key) => (
                  <span {...getTokenProps({ token, key })} />
                ))}
              </div>
            ))}
          </Pre>
        )}
      </Highlight>
    </>
  );
};
```

- Customizing Components:
  [https://www.gatsbyjs.org/docs/mdx/customizing-components/](https://www.gatsbyjs.org/docs/mdx/customizing-components/)

## Cover Image

## i11n

- [https://github.com/gatsbyjs/gatsby/tree/master/examples/using-i18n](https://github.com/gatsbyjs/gatsby/tree/master/examples/using-i18n)

## SEO

- this helped me for my own blog:
  [https://juliangaramendy.dev/custom-open-graph-images-in-gatsby-blog/](https://juliangaramendy.dev/custom-open-graph-images-in-gatsby-blog/)
- [https://www.heymeta.com/](https://www.heymeta.com/)
- [https://opengraphcheck.com/](https://opengraphcheck.com/)
- [https://cards-dev.twitter.com/validator](https://cards-dev.twitter.com/validator)
- [https://developers.facebook.com/tools/debug/sharing](https://developers.facebook.com/tools/debug/sharing)

## Commenting

- [https://github.com/utterance/utterances](https://github.com/utterance/utterances)

## Links

[https://www.gatsbyjs.org/packages/gatsby-plugin-mdx/](https://www.gatsbyjs.org/packages/gatsby-plugin-mdx/)
[site metadata]:
https://www.gatsbyjs.org/docs/gatsby-config/#sitemetadata [react
helmet]: https://www.gatsbyjs.org/packages/gatsby-plugin-react-helmet/
[mdx layouts]:
https://gatsby-mdx.netlify.com/api-reference/options/default-layouts/

<!-- Links -->

[windows web-dev bootstrap]:
  http://blog.scottspence.me/wsl-bootstrap-2019
[ubuntu as well]: https://www.youtube.com/watch?v=eSAsdQuQ-1o
[codesandbox.io]: https://codesandbox.io
[gatsby-source-filesystem]:
  https://www.gatsbyjs.org/packages/gatsby-source-filesystem/
[gatsby-plugin-mdx]:
  https://www.gatsbyjs.org/packages/gatsby-plugin-mdx/
[v0 may 2017]:
  https://github.com/spences10/blog.scottspence.me/tree/a470e8563e1a040527cf2094fc1b377550a88c77
[progressive disclosure of complexity]:
  https://lengstorf.com/progressive-disclosure-of-complexity/
[layout components]: https://www.gatsbyjs.org/docs/layout-components/
